{
  "name": "process-commit",
  "nodes": [
    {
      "parameters": {
        "url": "={{ $('get commit info').item.json.commit_api_url }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "n8n-workflow"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        128,
        -320
      ],
      "id": "babfb32e-1ab2-4ded-988b-ac12174ae9bb",
      "name": "Get diff",
      "credentials": {
        "httpHeaderAuth": {
          "id": "LJChBUVqPwSaw3Fk",
          "name": "SEAL-HACKATHON"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const diffNodeName = \"Get diff\";\nconst diffResults = $(diffNodeName).all(); \n\n\nlet totalAdditions = 0; // T∆∞∆°ng ƒë∆∞∆°ng v·ªõi 'insertions'\nlet totalDeletions = 0; // T∆∞∆°ng ƒë∆∞∆°ng v·ªõi 'deletions'\nlet modifiedFileCount = 0; // S·ªë l∆∞·ª£ng file c√≥ status l√† 'modified'\nlet messages = [];\nlet allPatches = [];\n\nif (diffResults.length > 0) {\n  for (const item of diffResults) {\n    if (item.json) {\n      \n      // 1. T√çNH T·ªîNG ADDITIONS V√Ä DELETIONS (t·ª´ thu·ªôc t√≠nh 'stats' c·ªßa commit)\n      if (item.json.stats) {\n        totalAdditions += item.json.stats.additions; // L·∫•y insertions\n        totalDeletions += item.json.stats.deletions; // L·∫•y deletions\n      }\n\n      // L·∫•y commit message\n      if (item.json.commit && item.json.commit.message) {\n        messages.push(item.json.commit.message);\n      }\n      \n      // 2. T√çNH S·ªê L∆Ø·ª¢NG FILE MODIFIED V√Ä T·ªîNG H·ª¢P PATCH CONTENT\n      if (item.json.files && Array.isArray(item.json.files)) {\n        for (const file of item.json.files) {\n          if (file.status === 'modified') {\n            modifiedFileCount++; // ƒê·∫øm s·ªë l∆∞·ª£ng file modified\n          }\n          if (file.patch) {\n            // ƒê·ªãnh d·∫°ng l·∫°i patch content cho d·ªÖ ƒë·ªçc\n            allPatches.push(`--- a/${file.filename}\\n+++ b/${file.filename}\\n${file.patch}`);\n          }\n        }\n      }\n    }\n  }\n}\n\n// --- PH·∫¶N 3: T·∫†O D·ªÆ LI·ªÜU CU·ªêI C√ôNG ---\n\nconst fullDataForAI = {\n  repo_full_name: $('get commit info').item.json.webhook_body.repository.full_name,\n  branch: $('get commit info').item.json.webhook_body.ref.split('/').pop(),\n  author_name: $('get commit info').item.json.webhook_body.head_commit.author.name,\n  author_email: $('get commit info').item.json.webhook_body.head_commit.author.email,\n  timestamp: $('get commit info').item.json.webhook_body.head_commit.timestamp,\n  commit_sha: $('get commit info').item.json.webhook_body.head_commit.id,\n  message: messages.join('; \\n'),\n  // G√°n c√°c gi√° tr·ªã ƒë√£ t√≠nh to√°n:\n  added: totalAdditions,   // T∆∞∆°ng ·ª©ng v·ªõi insertions\n  removed: totalDeletions, // T∆∞∆°ng ·ª©ng v·ªõi deletions\n  modified: modifiedFileCount, // S·ªë l∆∞·ª£ng file modified\n  diff_content: allPatches.join('\\n\\n')\n};\n\n// T·∫°o d·ªØ li·ªáu nh·∫π h∆°n ƒë·ªÉ g·ª≠i ƒëi (v√≠ d·ª•: Firebase)\nconst lightDataForFirebase = { ...fullDataForAI };\ndelete lightDataForFirebase.diff_content; // Lo·∫°i b·ªè patch content ƒë·ªÉ gi·∫£m dung l∆∞·ª£ng\n\n// Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn {\n  json: {\n    firebaseData: lightDataForFirebase, // D·ªØ li·ªáu nh·∫π cho Firebase\n    aiData: fullDataForAI             // D·ªØ li·ªáu ƒë·∫ßy ƒë·ªß cho c√°c b∆∞·ªõc sau\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        336,
        -320
      ],
      "id": "4d8db4d6-1c1b-4ab7-8623-03d833399b28",
      "name": "git diff summation",
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://zenlyclone-7bda4-default-rtdb.asia-southeast1.firebasedatabase.app/commit.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.firebaseData }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        528,
        -320
      ],
      "id": "9e38802f-e056-4217-80d4-d3753315de8a",
      "name": "INSERT Firebase",
      "credentials": {
        "googleApi": {
          "id": "PjEuClXipRaKeGCf",
          "name": "Google Service Account account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "338770ee-fbac-44a8-aba9-abe36a3c0a1b",
              "name": "repoFullName",
              "value": "={{ $('git diff summation').item.json.aiData.repo_full_name }}",
              "type": "string"
            },
            {
              "id": "97fe85f8-5c5c-4826-8971-fa2f4ede1320",
              "name": "branchName",
              "value": "={{ $('git diff summation').item.json.aiData.branch }}",
              "type": "string"
            },
            {
              "id": "02252ffb-5c40-42aa-b224-84a067a6b31d",
              "name": "commitMessages",
              "value": "={{ $('git diff summation').item.json.aiData.message }}",
              "type": "string"
            },
            {
              "id": "4cc8e5ef-8742-4874-8e4f-9d65aeda69b7",
              "name": "programmingLanguage",
              "value": "={{ $('get commit info').item.json.webhook_body.repository.language }}\n",
              "type": "string"
            },
            {
              "id": "d97b6df8-e052-42aa-b38f-ab012cb13c84",
              "name": "changeStats",
              "value": "={{\n  {\n    \"added\": $('git diff summation').item.json.aiData.added,\n    \"removed\": $('git diff summation').item.json.aiData.removed,\n    \"modified_files\": $('git diff summation').item.json.aiData.modified\n  }\n}}",
              "type": "string"
            },
            {
              "id": "da010869-684c-473d-ae4c-5f7e0c0db139",
              "name": "diffContent",
              "value": "={{ $('git diff summation').item.json.aiData.diff_content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        704,
        -320
      ],
      "id": "545b9f91-a798-4d65-aee3-7e5d806ed93a",
      "name": "Data for AI"
    },
    {
      "parameters": {
        "jsCode": "const allowedRepos = [\n  \"baodhg/ABDP\",\n  \"avatarstar1133/4TML\",\n  \"AIZY-Outsourcing/AIZY\",\n  \"Truongdat815/404_Not_Found\",\n  \"KOKONOI1706/4Loop\",\n  \"NguyenTrongNguyen04/Recurrence_Champion\",\n  \"TeddyPhamDat/Dynamo\",\n  \"nguyenbatan21112003/BrightWay\",\n  \"NhatLam1711/Sigma_boy\",\n  \"UGing265/ca_nhan_2\",\n  \"mineduck1608/AlphaCode\",\n  \"waanney/HCMUT-NQPN\",\n  \"The3dit0r/navy-intelli-doc\",\n  \"BUICUONGG/VLR\",\n  \"mihtriii/nguxloi\",\n  \"bechovang/SEAL-Underrate\",\n  \"HCMUS-HQHuy/HCMUS-HUE\",\n  \"lanam1612/DrillTime\",\n  \"NinhThienLuan/404_Brain_Not_Found\",\n  \"JascomLily/Inglorious-Basterds\",\n  \"10022007khoine-web/Canhan1\",\n  // ...\n];\nreturn {\n  allowedRepos: allowedRepos\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        -304
      ],
      "id": "5a2d5eee-8810-43be-a895-899d11ef801c",
      "name": "repo list"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c11cf45-c947-4511-9ad5-2cced9da5d08",
              "leftValue": "={{ $json.allowedRepos }}",
              "rightValue": "={{ $('get commit info').item.json.webhook_body.repository.full_name }}",
              "operator": {
                "type": "array",
                "operation": "contains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -96,
        -304
      ],
      "id": "c332a881-43c6-4ab4-9c6d-df24bf4e7ad8",
      "name": "Allowed Repo"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "550c356e-1536-49f9-949a-5cf1ecc9d4cb",
        "options": {
          "rawBody": true
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -672,
        -304
      ],
      "id": "cd8b903b-4c1b-4e11-8523-977f94c69552",
      "name": "Webhook",
      "webhookId": "550c356e-1536-49f9-949a-5cf1ecc9d4cb"
    },
    {
      "parameters": {
        "jsCode": "const crypto = require('crypto');\nconst secret = 'SEAL-HACKATHON-FALL2025';\n\nconst inputData = $input.item.json;\nconst headers = inputData.headers || {};\nconst body = inputData.body;\nconst sig = headers['x-hub-signature-256'] || headers['X-Hub-Signature-256'];\nconst event = headers['x-github-event'] || headers['X-GitHub-Event'];\n\nif (!sig) return [];\n\nconst payload = JSON.stringify(body);\nconst mac = 'sha256=' + crypto.createHmac('sha256', secret).update(payload).digest('hex');\nconst verified = crypto.timingSafeEqual(Buffer.from(sig), Buffer.from(mac));\n\nif (!verified || event !== 'push' || !body.commits || body.commits.length === 0) {\n  return [];\n}\n\nconst repoFullName = body.repository.full_name;\n\nconst itemsToProcess = body.commits.map(commit => {\n  const apiUrl = `https://api.github.com/repos/${repoFullName}/commits/${commit.id}`;\n\n  return {\n    json: {\n      commit_api_url: apiUrl,\n      commit_id: commit.id,\n      commit_message: commit.message,\n      webhook_body: body\n    }\n  }\n});\n\nreturn itemsToProcess;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -480,
        -304
      ],
      "id": "321ddba3-e7a9-46a9-ae40-f083d5c78044",
      "name": "Get Commit Info"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -672,
        16
      ],
      "id": "00c74326-3864-4e59-9cba-58a932337723",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "jsCode": "const repos = [\n  \"baodhg/ABDP\",\n  \"avatarstar1133/4TML\",\n  \"KOKONOI1706/4Loop\",\n  \"NguyenTrongNguyen04/Recurrence_Champion\",\n  \"AIZY-Outsourcing/AIZY\",\n  \"Truongdat815/404_Not_Found\",\n  \"TeddyPhamDat/Dynamo\",\n  \"nguyenbatan21112003/BrightWay\",\n  \"UGing265/ca_nhan_2\",\n  \"mineduck1608/AlphaCode\",\n  \"waanney/HCMUT-NQPN\",\n  \"The3dit0r/navy-intelli-doc\",\n  \"BUICUONGG/VLR\",\n  \"mihtriii/nguxloi\",\n  \"NhatLam1711/Sigma_boy\",\n  \"bechovang/SEAL-Underrate\",\n  \"HCMUS-HQHuy/HCMUS-HUE\",\n  \"lanam1612/DrillTime\",\n  \"NinhThienLuan/404_Brain_Not_Found\",\n  \"JascomLily/Inglorious-Basterds\",\n  \"10022007khoine-web/Canhan1\",\n  // ... th√™m ƒë·ªß 25 repo c·ªßa b·∫°n v√†o ƒë√¢y\n];\n\nreturn repos.map(repoFullName => {\n  // T√°ch chu·ªói \"owner/repo\" th√†nh hai ph·∫ßn\n  const parts = repoFullName.trim().split('/');\n  \n  return {\n    json: {\n      owner: parts[0],\n      repo: parts[1]\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -464,
        16
      ],
      "id": "24c616c4-e513-4822-8b2f-28b19a035bac",
      "name": "repo list1"
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.owner }}/{{ $json.repo }}/commits",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        16
      ],
      "id": "c6559817-9000-45be-9dba-6e776ee721f5",
      "name": "Get repo commit",
      "credentials": {
        "httpHeaderAuth": {
          "id": "LJChBUVqPwSaw3Fk",
          "name": "SEAL-HACKATHON"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// --- PH·∫¶N 1: L·∫§Y D·ªÆ LI·ªÜU ƒê·∫¶U V√ÄO ---\n\n// D·ªØ li·ªáu chi ti·∫øt c·ªßa commit t·ª´ node tr∆∞·ªõc ('Get commit details')\nconst diffData = $input.item.json;\n\n// L·∫•y th√¥ng tin repo t·ª´ node 'repo list' ƒë·ªÉ c√≥ t√™n ƒë·∫ßy ƒë·ªß\nconst repoInfo = $('get commit info').item.json;\n\n// --- PH·∫¶N 2: X·ª¨ L√ù V√Ä T·ªîNG H·ª¢P D·ªÆ LI·ªÜU ---\n\n// Kh·ªüi t·∫°o c√°c bi·∫øn, ki·ªÉm tra an to√†n ƒë·ªÉ tr√°nh l·ªói n·∫øu 'stats' kh√¥ng t·ªìn t·∫°i\nconst totalAdditions = diffData.stats ? diffData.stats.additions : 0;\nconst totalDeletions = diffData.stats ? diffData.stats.deletions : 0;\nlet modifiedFileCount = 0;\nlet allPatches = [];\n\n// L·∫∑p qua c√°c file ƒë·ªÉ ƒë·∫øm s·ªë file 'modified' v√† l·∫•y n·ªôi dung 'patch'\nif (diffData.files && Array.isArray(diffData.files)) {\n    for (const file of diffData.files) {\n        if (file.status === 'modified') {\n            modifiedFileCount++;\n        }\n        if (file.patch) {\n            // Th√™m header cho m·ªói patch ƒë·ªÉ AI d·ªÖ hi·ªÉu h∆°n\n            allPatches.push(`--- a/${file.filename}\\n+++ b/${file.filename}\\n${file.patch}`);\n        }\n    }\n}\n\n// --- PH·∫¶N 3: T·∫†O C√ÅC ƒê·ªêI T∆Ø·ª¢NG D·ªÆ LI·ªÜU CU·ªêI C√ôNG ---\nconst commitTimestampUTC = diffData.commit.author.date; \n\n// 2. LOGIC CHUY·ªÇN ƒê·ªîI TH√ÄNH M√öI GI·ªú B·∫†N MU·ªêN (UTC+7)\nconst targetTimezoneOffsetHours = 7; \nconst targetOffsetString = `+${targetTimezoneOffsetHours < 10 ? '0' + targetTimezoneOffsetHours : targetTimezoneOffsetHours}:00`;\n\nconst dateObject = new Date(commitTimestampUTC); \n\n// Th√™m offset (7 gi·ªù) v√†o th·ªùi ƒëi·ªÉm UTC ƒë·ªÉ c√≥ ƒë∆∞·ª£c th·ªùi ƒëi·ªÉm +07:00\nconst utcTime = dateObject.getTime();\nconst localTimeWithOffset = utcTime + (targetTimezoneOffsetHours * 60 * 60 * 1000);\nconst targetDate = new Date(localTimeWithOffset);\n\n// H√†m ƒë·ªãnh d·∫°ng chu·ªói theo ISO 8601 th·ªß c√¥ng ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ +07:00\nfunction formatToISOWithOffset(date, offsetStr) {\n    const pad = (n) => n < 10 ? '0' + n : n;\n    \n    // L·∫•y c√°c th√†nh ph·∫ßn ng√†y gi·ªù theo UTC ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√°n th·ªùi gian l√† ch√≠nh x√°c \n    // sau khi ƒë√£ c·ªông th√™m offset\n    const year = date.getUTCFullYear();\n    const month = pad(date.getUTCMonth() + 1);\n    const day = pad(date.getUTCDate());\n    const hours = pad(date.getUTCHours());\n    const minutes = pad(date.getUTCMinutes());\n    const seconds = pad(date.getUTCSeconds());\n    \n    return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}${offsetStr}`;\n}\n\nconst newTimestamp = formatToISOWithOffset(targetDate, targetOffsetString);\n// K·∫øt qu·∫£ newTimestamp s·∫Ω l√† '2025-11-01T17:03:07+07:00'\n// T·∫°o ƒë·ªëi t∆∞·ª£ng c∆° s·ªü ch·ª©a c√°c th√¥ng tin chung\nconst baseData = {\n  repo_full_name: `${repoInfo.owner}/${repoInfo.repo}`,\n  branch: 'main', // T·∫°m th·ªùi, v√¨ API n√†y kh√¥ng cung c·∫•p t√™n nh√°nh\n  author_name: diffData.commit.author.name,\n  author_email: diffData.commit.author.email,\n  timestamp: newTimestamp,\n  commit_sha: diffData.sha,\n  message: diffData.commit.message,\n  added: totalAdditions,\n  removed: totalDeletions,\n  modified: modifiedFileCount,\n  programming_language: 'unknown',\n};\n\n// D·ªØ li·ªáu cho Firebase l√† d·ªØ li·ªáu c∆° s·ªü\nconst lightDataForFirebase = { ...baseData };\n\n// D·ªØ li·ªáu cho AI l√† d·ªØ li·ªáu c∆° s·ªü c·ªông th√™m n·ªôi dung diff\nconst fullDataForAI = {\n  ...baseData,\n  diff_content: allPatches.join('\\n\\n') // N·ªëi c√°c patch l·∫°i th√†nh m·ªôt chu·ªói l·ªõn\n};\n\n// --- PH·∫¶N 4: TR·∫¢ V·ªÄ K·∫æT QU·∫¢ CHO N8N ---\nreturn {\n  json: {\n    firebaseData: lightDataForFirebase,\n    aiData: fullDataForAI\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        432,
        208
      ],
      "id": "9fa17006-51f8-4653-b0b5-83e035dda429",
      "name": "Summation"
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $('get commit info').item.json.owner }}/{{ $('get commit info').item.json.repo }}/commits/{{ $('Get repo commit').item.json.sha }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        208
      ],
      "id": "7caf2c6e-23ca-437f-81b3-65ba6b07a2a6",
      "name": "Get commit details",
      "credentials": {
        "httpHeaderAuth": {
          "id": "LJChBUVqPwSaw3Fk",
          "name": "SEAL-HACKATHON"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b92e38bb-6475-4a90-befb-d540029cc981",
              "leftValue": "={{ parseInt(Object.keys($json).length) }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -16,
        224
      ],
      "id": "2d945448-8cd4-4127-8f48-0bfdf3ec0d61",
      "name": "If"
    },
    {
      "parameters": {
        "url": "https://zenlyclone-7bda4-default-rtdb.asia-southeast1.firebasedatabase.app/commit.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "auth",
              "value": "AIzaSyAiXxqEVZHXwDu_sPl-PLnWuHr3hDf-BA0"
            },
            {
              "name": "orderBy",
              "value": "=\"commit_sha\""
            },
            {
              "name": "equalTo",
              "value": "={{ `\"${$json.sha}\"` }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        48,
        0
      ],
      "id": "a72a47d4-f9c3-40a2-a424-02062cb1af5c",
      "name": "Check Query",
      "credentials": {
        "googleApi": {
          "id": "PjEuClXipRaKeGCf",
          "name": "Google Service Account account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://zenlyclone-7bda4-default-rtdb.asia-southeast1.firebasedatabase.app/commit.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.firebaseData }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        624,
        208
      ],
      "id": "e6c20531-fadc-40dd-8e41-7a35c19709d2",
      "name": "INSERT Firebase1",
      "credentials": {
        "googleApi": {
          "id": "PjEuClXipRaKeGCf",
          "name": "Google Service Account account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "338770ee-fbac-44a8-aba9-abe36a3c0a1b",
              "name": "repoFullName",
              "value": "={{ $('Summation').item.json.firebaseData.repo_full_name }}",
              "type": "string"
            },
            {
              "id": "97fe85f8-5c5c-4826-8971-fa2f4ede1320",
              "name": "branchName",
              "value": "={{ $('Summation').item.json.aiData.branch }}",
              "type": "string"
            },
            {
              "id": "02252ffb-5c40-42aa-b224-84a067a6b31d",
              "name": "commitMessages",
              "value": "={{ $('Summation').item.json.aiData.message }}",
              "type": "string"
            },
            {
              "id": "4cc8e5ef-8742-4874-8e4f-9d65aeda69b7",
              "name": "programmingLanguage",
              "value": "={{ $('Summation').item.json.firebaseData.programming_language }}",
              "type": "string"
            },
            {
              "id": "d97b6df8-e052-42aa-b38f-ab012cb13c84",
              "name": "changeStats",
              "value": "={{\n  {\n    \"added\": $('Summation').item.json.aiData.added,\n    \"removed\": $('Summation').item.json.aiData.removed,\n    \"modified_files\": $('Summation').item.json.aiData.modified\n  }\n}}",
              "type": "string"
            },
            {
              "id": "da010869-684c-473d-ae4c-5f7e0c0db139",
              "name": "diffContent",
              "value": "={{ $('Summation').item.json.aiData.diff_content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        784,
        208
      ],
      "id": "4b8e858a-04d8-4f0d-8587-646110c40038",
      "name": "Data for AI1"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=B·∫°n l√† m·ªôt Tr∆∞·ªüng nh√≥m K·ªπ thu·∫≠t (Senior Technical Lead) chuy√™n gia v·ªÅ ƒë√°nh gi√° code. Nhi·ªám v·ª• c·ªßa b·∫°n l√† th·ª±c hi·ªán m·ªôt ph√¢n t√≠ch k·ªπ thu·∫≠t s√¢u v·ªÅ m·ªôt l·∫ßn push code d·ª±a tr√™n c√°c th√¥ng tin ƒë∆∞·ª£c cung c·∫•p. M·ª•c ti√™u c·ªßa b·∫°n l√† hi·ªÉu r√µ m·ª•c ƒë√≠ch, ngƒÉn x·∫øp c√¥ng ngh·ªá (technology stack), v√† c√°c ph·ª• thu·ªôc v√†o d·ªãch v·ª• b√™n ngo√†i.\n\n**D·ªÆ LI·ªÜU PUSH CODE C·∫¶N PH√ÇN T√çCH:**\n\n- **Repository:** {{ $('get commit info').first().json.repoFullName }}\n- **Branch:** {{ $('get commit info').first().json.branchName }}\n- **Th√¥ng ƒëi·ªáp t·ª´ L·∫≠p tr√¨nh vi√™n (√Ω ƒë·ªãnh):**\n\"\"\"\n{{ $('get commit info').first().json.commitMessages }}\n\"\"\"\n- **N·ªôi dung Code ƒë√£ thay ƒë·ªïi (b·∫±ng ch·ª©ng):**\n```diff\n{{ $('get commit info').first().json.diffContent }}\nY√äU C·∫¶U PH√ÇN T√çCH CHI TI·∫æT:\nD·ª±a v√†o TO√ÄN B·ªò d·ªØ li·ªáu tr√™n, h√£y ph√¢n t√≠ch v√† tr·∫£ l·ªùi c√°c c√¢u h·ªèi sau:\n1. Ph√¢n t√≠ch M·ª•c ƒë√≠ch (Purpose Analysis):\nD·ª±a v√†o c·∫£ \"Th√¥ng ƒëi·ªáp t·ª´ L·∫≠p tr√¨nh vi√™n\" v√† \"N·ªôi dung Code ƒë√£ thay ƒë·ªïi\", h√£y x√°c ƒë·ªãnh m·ª•c ƒë√≠ch ch√≠nh c·ªßa l·∫ßn push n√†y. Ph√¢n lo·∫°i n√≥ v√†o m·ªôt trong c√°c nh√≥m sau:\n\"X√¢y d·ª±ng t√≠nh nƒÉng m·ªõi\" (Feature Development)\n\"S·ª≠a l·ªói\" (Bug Fix)\n\"T√°i c·∫•u tr√∫c Code\" (Refactoring)\n\"C·∫≠p nh·∫≠t t√†i li·ªáu\" (Documentation)\n\"C√†i ƒë·∫∑t & C·∫•u h√¨nh\" (Setup & Configuration)\n\"Kh√°c\" (Other)\n2. Ph√¢n t√≠ch Ng√¥n ng·ªØ & Framework (Technology Stack Analysis):\nPh√¢n t√≠ch c√∫ ph√°p code, c√°c t·ª´ kh√≥a (import, require), v√† t√™n file trong diff_content.\nX√°c ƒë·ªãnh ng√¥n ng·ªØ l·∫≠p tr√¨nh ch√≠nh (v√≠ d·ª•: JavaScript, Python, Java).\nX√°c ƒë·ªãnh c√°c framework ho·∫∑c th∆∞ vi·ªán l·ªõn ƒë∆∞·ª£c s·ª≠ d·ª•ng (v√≠ d·ª•: React, Express.js, Django, Spring Boot).\n3. Ph√¢n t√≠ch API & D·ªãch v·ª• b√™n ngo√†i (External API & Service Detection):\nQu√©t k·ªπ diff_content ƒë·ªÉ t√¨m b·∫±ng ch·ª©ng v·ªÅ vi·ªác t√≠ch h·ª£p v·ªõi c√°c d·ªãch v·ª• c·ªßa b√™n th·ª© ba. T√¨m ki·∫øm c√°c d·∫•u hi·ªáu nh∆∞:\nC√°c l·ªánh import ho·∫∑c require c√°c SDK (v√≠ d·ª•: require('stripe'), import { S3Client } from '@aws-sdk/client-s3').\nC√°c URL endpoint c·ªßa API (v√≠ d·ª•: https://api.stripe.com/v1/...).\nC√°c bi·∫øn m√¥i tr∆∞·ªùng g·ª£i √Ω d·ªãch v·ª• (v√≠ d·ª•: process.env.TWILIO_AUTH_TOKEN).\nC√°c client kh·ªüi t·∫°o d·ªãch v·ª• (v√≠ d·ª•: new Stripe('sk_...')).\n4. Ph√¢n t√≠ch D·ªãch v·ª• AI (AI Service Detection):\nƒê·∫∑c bi·ªát ch√∫ √Ω ƒë·∫øn c√°c d·∫•u hi·ªáu t√≠ch h·ª£p v·ªõi c√°c d·ªãch v·ª• AI. T√¨m ki·∫øm c√°c t·ª´ kh√≥a v√† SDK li√™n quan ƒë·∫øn:\nNh√† cung c·∫•p: OpenAI, Google (Gemini, Vertex AI), Anthropic (Claude), Hugging Face.\nFramework: LangChain, LlamaIndex.\nT√™n model: gpt-4, claude-3, gemini-pro.\nTh∆∞ vi·ªán: openai, langchain, transformers, google-generativeai.\nƒê·ªäNH D·∫†NG ƒê·∫¶U RA:\nC√¢u tr·∫£ l·ªùi c·ªßa b·∫°n B·∫ÆT BU·ªòC ph·∫£i l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ vƒÉn b·∫£n n√†o tr∆∞·ªõc ho·∫∑c sau n√≥. C·∫•u tr√∫c JSON ph·∫£i nh∆∞ sau:\n{\n\"purpose_analysis\": {\n\"category\": \"string\",\n\"explanation\": \"string (gi·∫£i th√≠ch ng·∫Øn g·ªçn t·∫°i sao b·∫°n ch·ªçn category ƒë√≥)\"\n},\n\"tech_stack\": {\n\"language\": \"string\",\n\"frameworks\": [\"string\"],\n\"evidence\": \"string (gi·∫£i th√≠ch c√°ch b·∫°n x√°c ƒë·ªãnh ƒë∆∞·ª£c tech stack)\"\n},\n\"external_apis\": [\n{\n\"service_name\": \"string (v√≠ d·ª•: Stripe, AWS S3)\",\n\"evidence\": \"string (tr√≠ch d·∫´n d√≤ng code ho·∫∑c URL ch·ª©ng minh)\"\n}\n],\n\"ai_services\": [\n{\n\"service_name\": \"string (v√≠ d·ª•: OpenAI, LangChain)\",\n\"evidence\": \"string (tr√≠ch d·∫´n th∆∞ vi·ªán ho·∫∑c t·ª´ kh√≥a ch·ª©ng minh)\"\n}\n],\n\"overall_summary\": \"string (m·ªôt ƒëo·∫°n t√≥m t·∫Øt t·ªïng quan b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n v·ªÅ l·∫ßn push n√†y)\"\n}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        320,
        -96
      ],
      "id": "5bb34dab-5b0f-4ba2-96a4-445553080bb8",
      "name": "AI Analysis",
      "retryOnFail": true,
      "maxTries": 5,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "a0am0gHXQxDiILhN",
          "name": "Google Gemini(PaLM) Api account 12"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// B∆∞·ªõc 1: L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ AI.\n// S·ª¨A L·ªñI QUAN TR·ªåNG: Truy c·∫≠p v√†o ph·∫ßn t·ª≠ ƒê·∫¶U TI√äN [0] c·ªßa m·∫£ng 'parts'.\nconst rawString = $('AI Analysis').item.json.content.parts[0].text;\n\n// B∆∞·ªõc 2: Ki·ªÉm tra xem rawString c√≥ t·ªìn t·∫°i kh√¥ng tr∆∞·ªõc khi x·ª≠ l√Ω\nif (!rawString) {\n  throw new Error(\"Kh√¥ng nh·∫≠n ƒë∆∞·ª£c n·ªôi dung text t·ª´ AI Analysis. Ph·∫£n h·ªìi c√≥ th·ªÉ b·ªã r·ªóng.\");\n}\n\n// B∆∞·ªõc 3: T√¨m v√† tr√≠ch xu·∫•t JSON s·∫°ch (ƒë·ªÉ ph√≤ng tr∆∞·ªùng h·ª£p AI tr·∫£ v·ªÅ markdown)\nconst startIndex = rawString.indexOf('{');\nconst endIndex = rawString.lastIndexOf('}');\n\n// N·∫øu kh√¥ng t√¨m th·∫•y JSON, tr·∫£ v·ªÅ l·ªói ƒë·ªÉ d·ªÖ debug\nif (startIndex === -1 || endIndex === -1) {\n  throw new Error(\"Kh√¥ng t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá trong ph·∫£n h·ªìi c·ªßa AI.\");\n}\n\n// B∆∞·ªõc 4: Tr√≠ch xu·∫•t chu·ªói JSON s·∫°ch\nconst cleanedJsonString = rawString.substring(startIndex, endIndex + 1);\n\n// B∆∞·ªõc 5: Parse JSON\nlet parsedData;\ntry {\n  parsedData = JSON.parse(cleanedJsonString);\n} catch (error) {\n  throw new Error(\"L·ªói khi parse JSON: \" + error.message + \". Chu·ªói JSON l·ªói: \" + cleanedJsonString);\n}\n\n// B∆∞·ªõc 6: X·ª≠ l√Ω tr∆∞·ªùng h·ª£p AI tr·∫£ v·ªÅ c·∫•u tr√∫c {\"json\": {...}}\nconst finalObject = parsedData.json || parsedData;\n\n// B∆∞·ªõc 7: Tr·∫£ v·ªÅ k·∫øt qu·∫£ cu·ªëi c√πng\nreturn {\n  aiAnalysisObject: finalObject\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        624,
        -96
      ],
      "id": "ad9e3247-66fa-438e-b93c-bff8d53210ee",
      "name": "Parse AI Response"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// L·∫•y ƒë·ªëi t∆∞·ª£ng ph√¢n t√≠ch ƒë√£ ƒë∆∞·ª£c parse t·ª´ node tr∆∞·ªõc\nconst analysis = $('Parse AI Response').item.json.aiAnalysisObject;\n\n// S·ª¨A L·ªñI DUY NH·∫§T ·ªû ƒê√ÇY: D√πng ƒë√∫ng t√™n node m√† b·∫°n ƒë√£ ƒë·∫∑t l√† 'Get Data'\nconst originalData = $('get commit info').first().json;\n\n// --- 1. T·∫†O TI√äU ƒê·ªÄ (TITLE) CHO ISSUE ---\nconst issueTitle = `[SEAL Hackathon Analyst]`;\n\n\n// --- 2. T·∫†O N·ªòI DUNG (BODY) B·∫∞NG MARKDOWN ---\n// Ph·∫ßn c√≤n l·∫°i c·ªßa code ƒë√£ ƒë√∫ng, kh√¥ng c·∫ßn thay ƒë·ªïi.\nlet issueBody = `## ü§ñ Ph√¢n t√≠ch T·ª± ƒë·ªông cho Commit\\n\\n`;\nissueBody += `${analysis.purpose_analysis.category}`;\nissueBody += `**T√≥m t·∫Øt t·ªïng quan:** ${analysis.overall_summary}\\n\\n`;\nissueBody += `### üìù Ph√¢n t√≠ch Chi ti·∫øt\\n`;\nissueBody += `| H·∫°ng m·ª•c | K·∫øt qu·∫£ |\\n`;\nissueBody += `|---|---|\\n`;\nissueBody += `| **üéØ M·ª•c ƒë√≠ch** | ${analysis.purpose_analysis.category}: *${analysis.purpose_analysis.explanation}* |\\n`;\n\n// Ki·ªÉm tra tech_stack c√≥ t·ªìn t·∫°i kh√¥ng tr∆∞·ªõc khi truy c·∫≠p\nif (analysis.tech_stack) {\n  issueBody += `| **üíª Ng√¥n ng·ªØ & Framework** | ${analysis.tech_stack.language || 'N/A'} / ${(analysis.tech_stack.frameworks || []).join(', ') || 'N/A'} |\\n\\n`;\n}\n\n// --- 2a. Li·ªát k√™ c√°c API b√™n ngo√†i ---\nissueBody += `### üîå API & D·ªãch v·ª• B√™n ngo√†i ƒë∆∞·ª£c ph√°t hi·ªán\\n`;\nif (analysis.external_apis && analysis.external_apis.length > 0) {\n  for (const api of analysis.external_apis) {\n    issueBody += `- **${api.service_name}**: Ph√°t hi·ªán qua \\`${api.evidence}\\`\\n`;\n  }\n} else {\n  issueBody += `*Kh√¥ng ph√°t hi·ªán d·ªãch v·ª• n√†o.*\\n`;\n}\nissueBody += `\\n`;\n\n// --- 2b. Li·ªát k√™ c√°c d·ªãch v·ª• AI ---\nissueBody += `### üß† D·ªãch v·ª• AI ƒë∆∞·ª£c ph√°t hi·ªán\\n`;\nif (analysis.ai_services && analysis.ai_services.length > 0) {\n  for (const ai of analysis.ai_services) {\n    issueBody += `- **${ai.service_name}**: Ph√°t hi·ªán qua \\`${ai.evidence}\\`\\n`;\n  }\n} else {\n  issueBody += `*Kh√¥ng ph√°t hi·ªán d·ªãch v·ª• AI n√†o.*\\n`;\n}\n\n// --- 3. TR·∫¢ V·ªÄ K·∫æT QU·∫¢ ƒê√É ƒê·ªäNH D·∫†NG ---\nreturn {\n  json: {\n    issueTitle: issueTitle,\n    issueBody: issueBody,\n    repoFullName: originalData.repoFullName \n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        -96
      ],
      "id": "21c9526e-3288-43be-8a13-4e8c1266e6f8",
      "name": "Parse Data for Issue"
    },
    {
      "parameters": {
        "owner": {
          "__rl": true,
          "value": "={{ $('Parse Data for Issue').item.json.repoFullName.split('/')[0] }}",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "={{ $('Parse Data for Issue').item.json.repoFullName.split('/')[1] }}\n",
          "mode": "name"
        },
        "title": "={{ $('Parse Data for Issue').item.json.issueTitle }}\n",
        "body": "={{ $('Parse Data for Issue').item.json.issueBody }}\n",
        "labels": [],
        "assignees": []
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [
        1056,
        32
      ],
      "id": "01e30f1c-8a29-4d86-90f9-97ea6d44b47a",
      "name": "Create an issue",
      "webhookId": "e586edf4-e173-4840-9a08-13073e98f3bc",
      "credentials": {
        "githubApi": {
          "id": "2yndYjyaH8juXXYY",
          "name": "SEAL Hackathon"
        }
      }
    }
  ],
  "pinData": {
    "Data for AI": [
      {
        "json": {
          "name": "-OcjwLUJlSymVg6iTRlV"
        }
      }
    ]
  },
  "connections": {
    "Get diff": {
      "main": [
        [
          {
            "node": "git diff summation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "git diff summation": {
      "main": [
        [
          {
            "node": "INSERT Firebase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "INSERT Firebase": {
      "main": [
        [
          {
            "node": "Data for AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data for AI": {
      "main": [
        [
          {
            "node": "AI Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "repo list": {
      "main": [
        [
          {
            "node": "Allowed Repo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Allowed Repo": {
      "main": [
        [
          {
            "node": "Get diff",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Get Commit Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Commit Info": {
      "main": [
        [
          {
            "node": "repo list",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "repo list1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "repo list1": {
      "main": [
        [
          {
            "node": "Get repo commit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get repo commit": {
      "main": [
        [
          {
            "node": "Check Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summation": {
      "main": [
        [
          {
            "node": "INSERT Firebase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get commit details": {
      "main": [
        [
          {
            "node": "Summation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get commit details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Query": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "INSERT Firebase1": {
      "main": [
        [
          {
            "node": "Data for AI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data for AI1": {
      "main": [
        [
          {
            "node": "Create an issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Analysis": {
      "main": [
        [
          {
            "node": "Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Response": {
      "main": [
        [
          {
            "node": "Parse Data for Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Data for Issue": {
      "main": [
        [
          {
            "node": "Create an issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Vientiane",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": -1
  },
  "versionId": "0f0cf978-a500-4e53-9b06-b7b39f5391bd",
  "meta": {
    "instanceId": "3726bc349d670c49810ac1adbaf2c344a26110003c0b15c966645e06562eda8c"
  },
  "id": "xjfWpsWZI9iKv8d0",
  "tags": []
}